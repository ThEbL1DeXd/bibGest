@model bibGest.ViewModels.AdminDashboardViewModel
@{
    ViewData["Title"] = "Administration";
}

<!-- Page Header -->
<div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
    <div class="mb-3 mb-md-0">
        <h2 class="fw-bold mb-1">
            <i class="bi bi-shield-check text-primary me-2"></i>Tableau de bord administrateur
        </h2>
        <p class="text-muted mb-0">Vue d'ensemble du système</p>
    </div>
    <div class="dropdown">
        <button class="btn btn-primary dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="bi bi-plus-circle me-2"></i>Ajouter
        </button>
        <ul class="dropdown-menu dropdown-menu-end shadow">
            <li><a class="dropdown-item" asp-controller="Livres" asp-action="Create">
                <i class="bi bi-book me-2 text-primary"></i>Nouveau livre
            </a></li>
            <li><a class="dropdown-item" asp-controller="Utilisateurs" asp-action="Create">
                <i class="bi bi-person-plus me-2 text-success"></i>Nouvel utilisateur
            </a></li>
            <li><a class="dropdown-item" asp-controller="Categories" asp-action="Create">
                <i class="bi bi-tag me-2 text-info"></i>Nouvelle catégorie
            </a></li>
        </ul>
    </div>
</div>

<!-- Main Stats -->
<div class="row g-4 mb-4">
    <div class="col-6 col-lg-3">
        <div class="dashboard-stat">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="display-6 fw-bold">@Model.TotalBooks</div>
                    <div class="opacity-75 small">Livres</div>
                </div>
                <i class="bi bi-book stat-icon"></i>
            </div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="dashboard-stat stat-success">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="display-6 fw-bold">@Model.TotalUsers</div>
                    <div class="opacity-75 small">Utilisateurs</div>
                </div>
                <i class="bi bi-people stat-icon"></i>
            </div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="dashboard-stat stat-info">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="display-6 fw-bold">@Model.ActiveLoans</div>
                    <div class="opacity-75 small">Emprunts actifs</div>
                </div>
                <i class="bi bi-arrow-left-right stat-icon"></i>
            </div>
        </div>
    </div>
    <div class="col-6 col-lg-3">
        <div class="dashboard-stat stat-danger">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <div class="display-6 fw-bold">@Model.OverdueLoans</div>
                    <div class="opacity-75 small">En retard</div>
                </div>
                <i class="bi bi-exclamation-triangle stat-icon"></i>
            </div>
        </div>
    </div>
</div>

<!-- Secondary Stats -->
<div class="row g-4 mb-4">
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                            <i class="bi bi-journal-text text-primary" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h3 class="mb-0 fw-bold">@Model.TotalLoans</h3>
                        <small class="text-muted">Total emprunts (historique)</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="rounded-circle bg-warning bg-opacity-10 p-3">
                            <i class="bi bi-bookmark text-warning" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h3 class="mb-0 fw-bold">@Model.TotalReservations</h3>
                        <small class="text-muted">Total réservations</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-shrink-0">
                        <div class="rounded-circle bg-danger bg-opacity-10 p-3">
                            <i class="bi bi-cash-coin text-danger" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                    <div class="flex-grow-1 ms-3">
                        <h3 class="mb-0 fw-bold">@Model.TotalPenalties</h3>
                        <small class="text-muted">Pénalités émises</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <!-- Financial Overview -->
    <div class="col-lg-5">
        <div class="card h-100">
            <div class="card-header bg-white">
                <h5 class="mb-0 fw-bold">
                    <i class="bi bi-currency-euro text-success me-2"></i>Aperçu financier
                </h5>
            </div>
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
                    <div>
                        <div class="text-muted small">Total des pénalités</div>
                        <h4 class="mb-0 fw-bold">@Model.TotalPenaltyAmount.ToString("C", new System.Globalization.CultureInfo("fr-FR"))</h4>
                    </div>
                    <div class="bg-success bg-opacity-10 rounded-circle p-3">
                        <i class="bi bi-cash-stack text-success" style="font-size: 1.25rem;"></i>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center mb-4 pb-3 border-bottom">
                    <div>
                        <div class="text-muted small">Montant impayé</div>
                        <h4 class="mb-0 fw-bold text-danger">@Model.UnpaidPenaltyAmount.ToString("C", new System.Globalization.CultureInfo("fr-FR"))</h4>
                    </div>
                    <div class="bg-danger bg-opacity-10 rounded-circle p-3">
                        <i class="bi bi-exclamation-circle text-danger" style="font-size: 1.25rem;"></i>
                    </div>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <div class="text-muted small">Montant encaissé</div>
                        <h4 class="mb-0 fw-bold text-success">@((Model.TotalPenaltyAmount - Model.UnpaidPenaltyAmount).ToString("C", new System.Globalization.CultureInfo("fr-FR")))</h4>
                    </div>
                    <div class="bg-primary bg-opacity-10 rounded-circle p-3">
                        <i class="bi bi-check-circle text-primary" style="font-size: 1.25rem;"></i>
                    </div>
                </div>
                
                <a asp-controller="Penalites" asp-action="Index" class="btn btn-outline-primary w-100 mt-4">
                    <i class="bi bi-list-ul me-2"></i>Gérer les pénalités
                </a>
            </div>
        </div>
    </div>

    <!-- Category Stats -->
    <div class="col-lg-7">
        <div class="card h-100">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold">
                    <i class="bi bi-pie-chart text-primary me-2"></i>Statistiques par catégorie
                </h5>
                <a asp-controller="Categories" asp-action="Index" class="btn btn-sm btn-outline-primary">
                    Gérer
                </a>
            </div>
            <div class="card-body p-0">
                @if (Model.CategoryStats.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Catégorie</th>
                                    <th class="text-center">Livres</th>
                                    <th class="text-center">Emprunts</th>
                                    <th>Popularité</th>
                                </tr>
                            </thead>
                            <tbody>
                                @{
                                    var maxLoans = Model.CategoryStats.Max(c => c.LoanCount);
                                }
                                @foreach (var cat in Model.CategoryStats.OrderByDescending(c => c.LoanCount).Take(6))
                                {
                                    var percentage = maxLoans > 0 ? (cat.LoanCount * 100 / maxLoans) : 0;
                                    <tr>
                                        <td>
                                            <div class="fw-medium">@cat.CategoryName</div>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-light text-dark">@cat.BookCount</span>
                                        </td>
                                        <td class="text-center">
                                            <span class="badge bg-primary">@cat.LoanCount</span>
                                        </td>
                                        <td>
                                            <div class="progress" style="height: 8px;">
                                                <div class="progress-bar" role="progressbar" style="width: @percentage%; background: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);"></div>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="p-4 text-center text-muted">
                        <i class="bi bi-pie-chart" style="font-size: 2rem;"></i>
                        <p class="mb-0 mt-2">Aucune catégorie disponible</p>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<!-- Quick Links -->
<div class="row g-4 mt-2">
    <div class="col-md-3">
        <a asp-controller="Livres" asp-action="Index" class="card text-decoration-none h-100">
            <div class="card-body text-center py-4">
                <div class="rounded-circle bg-primary bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-3" 
                     style="width: 60px; height: 60px;">
                    <i class="bi bi-book text-primary" style="font-size: 1.5rem;"></i>
                </div>
                <h6 class="fw-bold text-dark mb-1">Livres</h6>
                <small class="text-muted">Gérer le catalogue</small>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-controller="Utilisateurs" asp-action="Index" class="card text-decoration-none h-100">
            <div class="card-body text-center py-4">
                <div class="rounded-circle bg-success bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-3" 
                     style="width: 60px; height: 60px;">
                    <i class="bi bi-people text-success" style="font-size: 1.5rem;"></i>
                </div>
                <h6 class="fw-bold text-dark mb-1">Utilisateurs</h6>
                <small class="text-muted">Gérer les comptes</small>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-controller="Emprunts" asp-action="Index" class="card text-decoration-none h-100">
            <div class="card-body text-center py-4">
                <div class="rounded-circle bg-info bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-3" 
                     style="width: 60px; height: 60px;">
                    <i class="bi bi-arrow-left-right text-info" style="font-size: 1.5rem;"></i>
                </div>
                <h6 class="fw-bold text-dark mb-1">Emprunts</h6>
                <small class="text-muted">Suivre les emprunts</small>
            </div>
        </a>
    </div>
    <div class="col-md-3">
        <a asp-controller="Reservations" asp-action="Index" class="card text-decoration-none h-100">
            <div class="card-body text-center py-4">
                <div class="rounded-circle bg-warning bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-3" 
                     style="width: 60px; height: 60px;">
                    <i class="bi bi-bookmark text-warning" style="font-size: 1.5rem;"></i>
                </div>
                <h6 class="fw-bold text-dark mb-1">Réservations</h6>
                <small class="text-muted">Gérer les demandes</small>
            </div>
        </a>
    </div>
</div>
